<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HerbalChain - Herbs Traceability System</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="min-h-screen">

    <div class="container">
        <div class="header-top">
            <img src="https://png.pngtree.com/png-clipart/20230807/original/pngtree-vector-logo-blockchain-network-symbol-currency-vector-picture-image_10132819.png" alt="HerbalChain Logo" class="logo-img">
            <img src="https://ayush.gov.in/resources/img/ministry-of-ayush-logo.png" alt="Ministry of Ayush Logo" class="ayush-logo">
            <div class="toggle-group">
                <button id="language-toggle" class="lang-toggle-btn">üåê</button>
                <button id="theme-toggle" class="theme-toggle-btn">üåô</button>
            </div>
        </div>
        <h1 class="title">HerbalChain Traceability</h1>
        <p class="description">Track the journey of herbs from farm to medicine cabinet.</p>

        <div class="tab-nav">
            <button class="tab-button active" data-tab="collector">Herb Collector</button>
            <button class="tab-button" data-tab="supplier">Supplier</button>
            <button class="tab-button" data-tab="manufacturer">Manufacturer</button>
            <button class="tab-button" data-tab="consumer">Consumer</button>
        </div>

        <div id="collector" class="tab-content active">
            <h2>Herb Collection</h2>
            <div class="form-section">
                <div>
                    <label for="collector-herb-name">Herb Name:</label>
                    <input type="text" id="collector-herb-name" placeholder="Example: Ashwagandha" required>
                </div>
                <div>
                    <label for="collector-location">Collector Location:</label>
                    <div class="form-group-flex">
                        <input type="text" id="collector-location" placeholder="e.g., Village, District, State - Pincode" required>
                        <button id="capture-collector-location-btn" class="btn" style="white-space: nowrap; font-size: 0.9rem;">Auto-Capture</button>
                    </div>
                </div>
                <div>
                    <label for="collector-quantity">Units:</label>
                    <div class="unit-input-group">
                        <input type="number" id="collector-quantity" placeholder="100" required>
                        <select id="collector-unit-select">
                            <option value="Kg">Kg</option>
                            <option value="Gram">Gram</option>
                            <option value="Pieces">Pieces</option>
                            <option value="Bundles">Bundles</option>
                        </select>
                    </div>
                </div>
                <div class="ai-camera-container">
                    <label>AI Quality Check (Live Camera):</label>
                    <video id="collector-camera-preview" autoplay style="display:none; width: 100%; max-width: 400px; border: 1px solid var(--border-color); border-radius: 0.5rem;"></video>
                    <canvas id="collector-canvas" style="display:none;"></canvas>
                    <div class="camera-buttons">
                        <button id="start-collector-camera-btn" class="btn" style="font-size: 0.9rem;">Start Camera</button>
                        <button id="check-collector-quality-btn" class="btn" style="font-size: 0.9rem; display:none;">Take Snapshot & Check</button>
                        <button id="stop-collector-camera-btn" class="btn" style="font-size: 0.9rem; display:none;">Stop Camera</button>
                    </div>
                </div>
                <div id="collector-quality-result" class="status-message"></div>
                <button id="add-herb-btn" class="btn">Record on Blockchain</button>
            </div>
            <div id="collector-status" class="status-message"></div>
        </div>

        <div id="supplier" class="tab-content">
            <h2>Verify Received Herb Batch</h2>
            <div class="form-section">
                <div>
                    <label for="verify-herb-id">Select Unverified Batch:</label>
                    <select id="verify-herb-id" required>
                        <option value="">No unverified batches found...</option>
                    </select>
                </div>
                <div>
                    <label for="measured-quantity">Measured Quantity:</label>
                    <div class="unit-input-group">
                        <input type="number" id="measured-quantity" placeholder="Enter actual received quantity" required>
                        <select id="measured-unit-select" disabled>
                            <option value="Kg">Kg</option>
                            <option value="Gram">Gram</option>
                            <option value="Pieces">Pieces</option>
                            <option value="Bundles">Bundles</option>
                        </select>
                    </div>
                </div>
                <button id="verify-receipt-btn" class="btn">Verify & Confirm Receipt</button>
            </div>
            <div id="verify-status" class="status-message"></div>
            
            <hr style="margin: 2rem 0; border-top: 2px solid var(--border-color);">

            <h2>Transfer Verified Herb</h2>
            <div class="form-section">
                <div>
                    <label for="transfer-herb-id">Select Verified Herb:</label>
                    <select id="transfer-herb-id" required>
                        <option value="">Select a verified herb...</option>
                    </select>
                </div>
                <div>
                    <label for="transfer-to">Transfer To (ID):</label>
                    <select id="transfer-to" required>
                        <option value="">Select Manufacturer</option>
                        <option value="MANU-001">Dabur India Limited</option>
                    </select>
                </div>
                <div>
                    <label for="supplier-location">Supplier Location:</label>
                    <div class="form-group-flex">
                        <input type="text" id="supplier-location" placeholder="e.g., Supplier Warehouse, Delhi" required>
                        <button id="capture-supplier-location-btn" class="btn" style="white-space: nowrap; font-size: 0.9rem;">Auto-Capture</button>
                    </div>
                </div>
                <div>
                    <label for="supplier-weight">Units to Transfer:</label>
                    <div class="unit-input-group">
                        <input type="number" id="supplier-weight" placeholder="98" required>
                        <select id="supplier-unit-select" disabled>
                            <option value="Kg">Kg</option>
                            <option value="Gram">Gram</option>
                            <option value="Pieces">Pieces</option>
                            <option value="Bundles">Bundles</option>
                        </select>
                    </div>
                    <span id="available-units-supplier"></span>
                </div>
                <div class="ai-camera-container">
                    <label>AI Quality Check (Live Camera):</label>
                    <video id="supplier-camera-preview" autoplay style="display:none; width: 100%; max-width: 400px; border: 1px solid var(--border-color); border-radius: 0.5rem;"></video>
                    <canvas id="supplier-canvas" style="display:none;"></canvas>
                    <div class="camera-buttons">
                        <button id="start-supplier-camera-btn" class="btn" style="font-size: 0.9rem;">Start Camera</button>
                        <button id="check-supplier-quality-btn" class="btn" style="font-size: 0.9rem; display:none;">Take Snapshot & Check</button>
                        <button id="stop-supplier-camera-btn" class="btn" style="font-size: 0.9rem; display:none;">Stop Camera</button>
                    </div>
                </div>
                <div id="supplier-quality-result" class="status-message"></div>
                <button id="transfer-herb-btn" class="btn">Transfer</button>
            </div>
            <div id="supplier-status" class="status-message"></div>
        </div>

        <div id="manufacturer" class="tab-content">
            <h2>Produce Medicine & Generate QR Code</h2>
            <div class="form-section">
                <div>
                    <label for="batch-id">Batch ID:</label>
                    <input type="text" id="batch-id" placeholder="Example: MED-BATCH-001" required>
                </div>
                <div>
                    <label for="manufacturer-location">Production Location:</label>
                    <div class="form-group-flex">
                        <input type="text" id="manufacturer-location" placeholder="e.g., Production Unit, Haridwar" required>
                        <button id="capture-manufacturer-location-btn" class="btn" style="white-space: nowrap; font-size: 0.9rem;">Auto-Capture</button>
                    </div>
                </div>
                <div id="multi-batch-container">
                    <label>Used Herb Batches:</label>
                    <div id="multi-batch-inputs" class="multi-batch-input-container"></div>
                    <button id="add-batch-btn" class="btn" style="width: auto; margin-top: 1rem;">Add Herb Batch</button>
                </div>
                <div>
                    <label for="final-medicine-units">Final Medicine Units:</label>
                    <div class="unit-input-group">
                        <input type="number" id="final-medicine-units" placeholder="Units Produced" required>
                        <select id="final-medicine-unit-select">
                            <option value="Kg">Kg</option>
                            <option value="Gram">Gram</option>
                            <option value="Pieces">Pieces</option>
                            <option value="Bottles">Bottles</option>
                        </select>
                    </div>
                </div>
                <div class="ai-camera-container">
                    <label>Final Product Quality Check (Live Camera):</label>
                    <video id="manufacturer-camera-preview" autoplay style="display:none; width: 100%; max-width: 400px; border: 1px solid var(--border-color); border-radius: 0.5rem;"></video>
                    <canvas id="manufacturer-canvas" style="display:none;"></canvas>
                    <div class="camera-buttons">
                        <button id="start-manufacturer-camera-btn" class="btn" style="font-size: 0.9rem;">Start Camera</button>
                        <button id="check-manufacturer-quality-btn" class="btn" style="font-size: 0.9rem; display:none;">Take Snapshot & Check</button>
                        <button id="stop-manufacturer-camera-btn" class="btn" style="font-size: 0.9rem; display:none;">Stop Camera</button>
                    </div>
                </div>
                <div id="manufacturer-quality-result" class="status-message"></div>
                <button id="produce-medicine-btn" class="btn">Produce Medicine & Generate QR Code</button>
            </div>
            <div id="qr-code-area" class="qr-area">
                <h3 class="title" id="qr-title" style="display:none;">Generated QR Code</h3>
                <div id="qrcode"></div>
                <div id="generated-qr-count"></div>
            </div>
            <div id="manufacturer-status" class="status-message"></div>
        </div>

        <div id="consumer" class="tab-content">
            <h2>Scan QR Code</h2>
            <div class="form-section">
                <div id="reader" style="width: 100%; max-width: 400px; margin: auto; border-radius: 10px; overflow: hidden;"></div>
                <div class="camera-buttons">
                    <button id="start-scan-btn" class="btn">Start Camera Scan</button>
                    <button id="stop-scan-btn" class="btn" style="display: none;">Stop Camera</button>
                </div>
                <p style="text-align: center; margin: 1rem 0; font-weight: bold;">OR</p>
                <div>
                    <label for="qr-image-input">Upload QR Code Image to Trace:</label>
                    <input type="file" id="qr-image-input" accept="image/*">
                </div>
                <div id="file-scanner-container" style="display: none;"></div>
            </div>
            <div id="trace-result" class="hidden">
                <h3 class="title">Trace Result</h3>
                <div id="trace-content"></div>
            </div>
        </div>
        
        <div class="reputation-section">
            <h2>Participant Reputation Scores</h2>
            <div id="reputation-scores" class="reputation-grid">
                </div>
        </div>

        <div class="ledger-section">
            <h2 style="text-align: center;">Blockchain Ledger</h2>
            <div id="blockchain-ledger" class="ledger-table-container">
                <table class="ledger-table">
                    <thead>
                        <tr>
                            <th>Block ID</th>
                            <th>Previous Hash</th>
                            <th>Current Hash</th>
                            <th>Data</th>
                            <th>Fraud Alert</th>
                            <th>Quality Match</th>
                        </tr>
                    </thead>
                    <tbody id="ledger-body">
                        <tr><td colspan="6" style="text-align: center; color: var(--accent-color);">No transactions yet.</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="ledger-actions">
                <button id="download-pdf-btn" class="btn">Download Ledger (PDF)</button>
                <button id="clear-data-btn" class="btn btn-danger">Clear All Data</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>